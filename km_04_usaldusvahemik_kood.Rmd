---
title: "Usaldusvahemik"
author: "Indrek Soidla"
institute: "Tartu Ülikool"
date: "2023/09/23 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, message = FALSE, warning = FALSE)
```

### Laeme andmed sisse, eraldame Eesti andmed

```{r message = FALSE, warning = FALSE}
library(haven)
library(tidyverse)
r8 <- read_spss("data/ESS8e02_2.sav")

ee8 <- r8 |>
  filter(cntry == "EE") |>
  select(lkredcc, region, pspwght)
```

---

### Kontrollime tunnuse `lkredcc` jaotusparameetreid

```{r message = FALSE, warning = FALSE}
library(summarytools)
descr(ee8$lkredcc)
```

---

### Kodeerime tunnuse `region` ümber eestikeelseks

```{r}
ee8$region <- dplyr::recode(as.factor(ee8$region), 
                     "EE001" = "Põhja-Eesti", 
                     "EE004" = "Lääne-Eesti",
                     "EE006" = "Kesk-Eesti",
                     "EE007" = "Kirde-Eesti",
                     "EE008" = "Lõuna-Eesti")
table(ee8$region)
```

---

### Arvutame paketi `meantables` abiga hinnangute keskmised ja usalduspiirid regiooniti

```{r warning = FALSE, message = FALSE, eval = FALSE}
# install.packages("meantables")
library(meantables)

ee8 |>
  group_by(region) |>
  mean_table(lkredcc)
```

```{r mean-table-html, warning = FALSE, message = FALSE, echo = FALSE}
# install.packages("meantables")
library(meantables)

ee8 |>
  group_by(region) |>
  mean_table(lkredcc) |>
  knitr::kable(format = 'html')
```

---

### Punktdiagramm

.pull-left[
```{r}
lk_95 <- ee8 |>
  group_by(region) |>
  mean_table(lkredcc)
```

```{r plot-point-i, eval = FALSE}
ggplot(lk_95, 
       aes(x = group_cat, 
                  y = mean)) +
  geom_point()
```
]

.pull-right[
```{r ref.label = "plot-point-i", echo = FALSE}
```
]

---

### Vahemikdiagramm

.pull-left[
```{r plot-error, eval = FALSE}
ggplot(lk_95, 
       aes(x = group_cat, 
           y = mean)) +
  geom_point() +
  geom_errorbar(
    aes(ymin = lcl, 
        ymax = ucl), 
    width = 0.1)
```
]

.pull-right[
```{r ref.label = "plot-error", echo = FALSE}
```
]

---

### Millest sõltub usaldusvahemiku laius?

```{r eval = FALSE}
ee8 |>
  group_by(region) |>
  mean_table(lkredcc) |>
  mutate(laius = ucl - lcl) |>
  select(group_cat, n, mean, sd, laius)
```

```{r echo = FALSE}
ee8 |>
  group_by(region) |>
  mean_table(lkredcc) |>
  mutate(laius = ucl - lcl) |>
  select(group_cat, n, mean, sd, laius) |>
  knitr::kable(format = 'html')
```

---

### Kuidas sõltub usaldusvahemiku laius usaldusnivoost?

Arvutame usalduspiirid ka usaldusnivoodel 99% ja 90%

```{r}
lk_99 <- ee8 |>
  group_by(region) |>
  mean_table(lkredcc, t_prob = 0.995)

lk_90 <- ee8 |>
  group_by(region) |>
  mean_table(lkredcc, t_prob = 0.95)
```

---

### Usaldusvahemikud eri usaldusnivoodel

```{r plot-error-3, eval = FALSE}
ggplot(lk_95, aes(x = group_cat, y = mean)) +
  geom_point() +
  geom_errorbar(data = lk_99, aes(ymin = lcl, ymax = ucl),  #<<
                width = 0.05, colour = "blue") + #<<
  geom_errorbar(aes(ymin = lcl, ymax = ucl), width = 0.1) +
  geom_errorbar(data = lk_90, aes(ymin = lcl, ymax = ucl),  #<<
                width = 0.15, colour = "red")  #<<
```

---

### Usaldusvahemikud eri usaldusnivoodel

```{r ref.label = "plot-error-3", echo = FALSE}
```

---

### Uurime lähemalt usaldusvahemikke usaldusnivool 95%

.pull-left[
```{r ref.label = "plot-error", eval = FALSE}
```
]

.pull-right[
```{r ref.label = "plot-error", echo = FALSE}
```
]

---

### Harjutus 3

```{r}
ee8a <- r8 %>% 
  filter(cntry == "EE") %>% 
  select(gvsrdcc, edulvlb, pspwght)

ee8a <- ee8a %>% 
  mutate(har = case_when(edulvlb <= 213 ~ "Kuni põhiharidus",
                         edulvlb == 313 ~ "Keskharidus",
                         edulvlb > 213 & edulvlb < 600 ~ "Kutseharidus",
                         edulvlb >= 600 ~ "Kõrgharidus"))

library(forcats)
ee8a$har <- fct_relevel(ee8a$har, 
                        "Kuni põhiharidus", 
                        "Kutseharidus", 
                        "Keskharidus", 
                        "Kõrgharidus")
```

---

### Harjutus 3

.pull-left[
```{r}
gs_uv <- ee8a |>
  drop_na(har) |>
  group_by(har) |>
  mean_table(gvsrdcc)
```

```{r plot-error-ex3, eval = FALSE}
ggplot(gs_uv, 
       aes(x = group_cat, 
                  y = mean)) +
  geom_point() +
  geom_errorbar(
    aes(ymin = lcl, 
        ymax = ucl), 
    width = 0.1
    )
```
]

.pull-right[
```{r ref.label = "plot-error-ex3", echo = FALSE}
```
]

---

class: center, middle, inverse

# Keskmiste vahe usalduspiirid 

---

### Arvutame keskmiste vahede usalduspiirid

```{r}
ee8 %>%   filter(region == "Kirde-Eesti" | region == "Kesk-Eesti") %>% 
  t.test(lkredcc ~ region, data = .)
```

---

### Arvutame keskmiste vahede usalduspiirid

```{r}
ee8 %>% 
  filter(region == "Kirde-Eesti" | region == "Lääne-Eesti") %>% 
  t.test(lkredcc ~ region, data = .)
```

---

### Harjutus 4

```{r}
ee8a %>% 
  filter(har == "Kuni põhiharidus" | har == "Kutseharidus") %>% 
  t.test(gvsrdcc ~ har, data = .)
```

---

### Harjutus 4

```{r}
ee8a %>% 
  filter(har == "Kuni põhiharidus" | har == "Keskharidus") %>% 
  t.test(gvsrdcc ~ har, data = .)
```

---

### Harjutus 4

```{r}
ee8a %>% 
  filter(har == "Kutseharidus" | har == "Keskharidus") %>% 
  t.test(gvsrdcc ~ har, data = .)
```

---

### Harjutus 4

```{r}
ee8a %>% 
  filter(har == "Keskharidus" | har == "Kõrgharidus") %>% 
  t.test(gvsrdcc ~ har, data = .)
```

---

class: center, middle, inverse

# Usaldusvahemike arvutamine kaaludega

---

### Usaldusvahemike arvutamine kaaludega

- Eelnevad näited olid lihtsuse mõttes tehtud ilma kaaludeta, täpsemate tulemuste saamiseks oleks tarvis ESS-i andmete puhul kasutada ka järelkihistamiskaale

- Selleks on tarvis paketi survey abi

```{r message = FALSE, warning = FALSE}
# install.packages("survey")
library(survey)

ee8w <- svydesign(id = ~1, data = ee8, weights = ~pspwght)
```

---

### Arvutame tunnuse lkredcc kaalutud keskmise ja usalduspiirid

```{r}
svymean(~lkredcc, design = ee8w, na.rm = TRUE)
```

--

```{r}
svymean(~lkredcc, design = ee8w, na.rm = TRUE) %>% 
  confint()
```

---

### Arvutame tunnuse lkredcc kaalutud keskmised ja usalduspiirid regioonides

```{r}
svyby(~lkredcc, ~region, design = ee8w, FUN = svymean, 
      na.rm = TRUE, vartype = c("se", "ci"))
```

---

### Teeme sõltumatute kogumite t-testi kaalutud andmetega

Loome iga regiooni jaoks eraldi andmestikud

```{r message = FALSE, warning = FALSE}
# install.packages("weights")
library(weights)

lk_ki <- ee8 %>% 
  filter(region == "Kirde-Eesti")

lk_ke <- ee8 %>% 
  filter(region == "Kesk-Eesti")

lk_le <- ee8 %>% 
  filter(region == "Lõuna-Eesti")
```

---

### Teeme sõltumatute kogumite t-testi kaalutud andmetega

```{r}
wtd.t.test(lk_ki$lkredcc, lk_ke$lkredcc, 
           weight = lk_ki$pspwght, weighty = lk_ke$pspwght)
```


---

### Teeme sõltumatute kogumite t-testi kaalutud andmetega

```{r}
wtd.t.test(lk_ki$lkredcc, lk_le$lkredcc, 
           weight = lk_ki$pspwght, weighty = lk_le$pspwght)
```

---

### `wtd.t.test` ei anna kaalutud keskmiste vahe usalduspiire

- Aga need saab ise arvutada standardvea põhjal

- Omistame testitulemused uuele objektile `t_test_ki_le`

```{r warning = FALSE}
t_test_ki_le <- wtd.t.test(lk_ki$lkredcc, lk_le$lkredcc, 
                           weight = lk_ki$pspwght, 
                           weighty = lk_le$pspwght)
```

---

### Arvutame keskmiste vahe usalduspiirid

```{r}
str(t_test_ki_le)
```

- Alumine usalduspiir usaldusnivool 95%

```{r}
t_test_ki_le$additional[1] - 1.96 * t_test_ki_le$additional[4]
```

- Ülemine usalduspiir usaldusnivool 95%

```{r}
t_test_ki_le$additional[1] + 1.96 * t_test_ki_le$additional[4]
```

---

### Harjutus 5

```{r}
ee8w <- svydesign(id = ~1, data = ee8a, weights = ~pspwght)

svyby(~gvsrdcc, ~har, design = ee8w, FUN = svymean, 
      na.rm = TRUE, vartype = c("se", "ci"))

gs_uv_w <- svyby(~gvsrdcc, ~har, design = ee8w, FUN = svymean, 
      na.rm = TRUE, vartype = c("se", "ci"))
```

```{r plot-error-w-ex5, eval = FALSE}
ggplot(gs_uv_w, aes(x = har, y = gvsrdcc)) +
  geom_point(stat = "identity") +
  geom_errorbar(aes(ymin = ci_l, ymax = ci_u), width = 0.1) +
  labs(title = "Vahemikdiagramm kaalutud andmetega") +
  ylim(4, 5.5)
```

---

### Harjutus 5

.pull-left[
```{r echo = FALSE}
ggplot(gs_uv, 
       aes(x = group_cat, 
                  y = mean)) +
  geom_point() +
  geom_errorbar(
    aes(ymin = lcl, 
        ymax = ucl), 
    width = 0.1
    ) +
  labs(title = "Vahemikdiagramm kaalumata andmetega") +
  ylim(4, 5.5)
```

]

.pull-right[
```{r ref.label = "plot-error-w-ex5", echo = FALSE}
```
]

---

class: center, middle, inverse

# Osakaalu usaldusvahemik

---

### Osakaalu (protsentnäitaja) usalduspiirid

$$p >= \hat{p} - z_{1 - \frac{\alpha}{2}} \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}$$

$$p <= \hat{p} + z_{1 - \frac{\alpha}{2}} \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}$$

- $p$ -- osakaal populatsioonis

- $\hat{p}$ -- osakaal valimis

- $z_{1 - \frac{\alpha}{2}}$ -- standardiseeritud normaaljaotuse $1 - \frac{\alpha}{2}$-kvantiil, kus $\alpha$ on vea tõenäosuse piir

  - nt usaldusnivool 90% $\alpha = 10\%$, vastav $z_{1 - \frac{\alpha}{2}} = 1.64$
  - nt usaldusnivool 95% $\alpha = 5\%$, vastav $z_{1 - \frac{\alpha}{2}} = 1.96$
  - nt usaldusnivool 99% $\alpha = 1\%$, vastav $z_{1 - \frac{\alpha}{2}} = 2.58$

- $n$ -- valimi suurus

- Mida lähemal osakaal 50%-le, seda laiem on usaldusvahemik

---

### Osakaalu usaldusvahemiku laius

- Kuidas sõltub osakaalu usaldusvahemik osakaalu (protsentnäitaja) suurusest?

- Näide valimi n = 1000 kohta

```{r}
p <- seq(0, 1, 0.01)

dat <- data.frame(p)

dat$veapiir <- 1.96 * sqrt(p * (1 - p) / 1000)

knitr::kable(dat, format = 'html')
```

---

### Osakaalu usaldusvahemiku laius

```{r}
joonis <- ggplot(dat, aes(p, veapiir)) +
  geom_path()
```

---

### Osakaalu usaldusvahemiku laius

```{r}
plotly::ggplotly(joonis)
```

---

### Veapiir

- Pool usaldusvahemikust ehk $z_{1 - \frac{\alpha}{2}} \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}$ = veapiir

- Korrektne kasutada ainult tõenäosusliku valimiga uuringu puhul 

- See eeldus kehtib igasuguse järeldava analüüsi kohta

---

### Osakaalude usaldusvahemike arvutamine

- Kasutame kahe erakondade reitingu uuringu andmeid (aastast 2020):

- Turu-uuringute AS, 12.-24. aug, n = 1003 (https://www.err.ee/1127504/turu-uuringud-reformierakonna-toetus-jai-augustis-keskerakonnale-alla)

- Turu-uuringute AS, 7.-17. sept, n = 1010, https://www.err.ee/1138657/reitingud-reformierakond-tousis-taas-populaarseimaks-parteiks). 

- Näide on selles mõttes meie jaoks kehv, et reitingud on ümardatud täisarvuni, aga käsitleme siis neid harjutuse korras kui uuringuga saadud tulemusi

---

### Osakaalude usaldusvahemike arvutamine

```{r}
erakond <- rep(c("RE", "KE", "EKRE", "SDE", "Eesti 200", "Isamaa", 
                 "Rohelised", "Tulevik", "Muu"), 2)
reiting <- data.frame(erakond)
reiting$poolehoid <- c(0.23, 0.26, 0.20, 0.10, 0.09, 0.05, 0.02, 
                       0.01, 0.04, 0.27, 0.24, 0.16, 0.11, 0.09, 
                       0.05, 0.03, 0.03, 0.02)
reiting$kuu <- c(rep("August", 9), rep("September", 9))
reiting
```

---

### Vaatame tulemusi ka joonisel

```{r reitingud-tulp, eval = FALSE}
ggplot(reiting, aes(x = erakond, y = poolehoid, fill = kuu)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.6) +
  scale_x_discrete(limits = reiting$erakond[1:9]) +
  labs(x = "Erakond",
       y = "Osakaal") +
  theme_light() 
```

---

### Vaatame tulemusi ka joonisel

```{r ref.label = "reitingud-tulp", fig.dim = c(7.5, 4.25), out.width = "100%", echo = FALSE}
```

---

### Osakaalude usaldusvahemike arvutamine

- Uudise pealkiri oli, et RE tõusis taas populaarseimaks parteiks

- Kas saame siiski uuringu andmetel väita, et muutus RE ja KE poolehoiuprotsentides esineb ka populatsioonis (eeldades, et täisarvulised protsendid on täpsed)?

- Arvutame usalduspiirid ja lisame joonisele

---

### Osakaalude usaldusvahemike arvutamine

- Kasutame usaldusvahemike arvutamiseks funktsiooni `MultinomCI`, mis eeldab indiviidide arve, mitte protsentjaotust

- Seega arvutame kõigepealt reitingute põhjal vastajate arvud (st kui palju vastajaid mingit erakonda eelistavad)

```{r}
reiting <- reiting %>% 
  mutate(poolehoid_n = ifelse(kuu == "August", 
                              poolehoid * 1003, 
                              poolehoid * 1010) %>% 
           round())
```

---

### Osakaalude usaldusvahemike arvutamine

- Arvutame usalduspiirid, kasutades funktsiooni `MultinomCI` paketist `DescTools`

- Reitingute usalduspiirid on vaja arvutada augusti ja septembri kohta eraldi, sest eri kuude reitingud moodustavad omaette tervikud (ühe kuu reitingud moodustavad kokku 100%)

```{r message = FALSE, warning = FALSE}
# install.packages("DescTools")
library(DescTools)

poolehoid_aug <- reiting %>% 
  filter(kuu == "August") %>% 
  pull(poolehoid_n) %>% 
  MultinomCI(conf.level = 0.95, method = "wilson")

poolehoid_sept <- reiting %>% 
  filter(kuu == "September") %>% 
  pull(poolehoid_n) %>% 
  MultinomCI(conf.level = 0.95, method = "wilson")
```

---

### Paneme reitingute usalduspiirid kokku üheks tabeliks objekti `poolehoid_ci`

```{r}
poolehoid_ci <- rbind(poolehoid_aug, poolehoid_sept) %>% 
  as.data.frame()
poolehoid_ci
```

---

### Lisame algsest andmestikust ka erakondade nimed ja kuud

```{r}
poolehoid_ci$erakond <- reiting$erakond
poolehoid_ci$kuu <- reiting$kuu
poolehoid_ci
```

---

### Paneme reitingud koos usalduspiiridega joonisele

```{r reitingud, eval = FALSE}
library(scales)
ggplot(poolehoid_ci, aes(x = erakond, y = est, fill = kuu)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.9) +
  geom_errorbar(aes(ymin = lwr.ci, ymax = upr.ci), position = position_dodge2(width = 0.6, padding = 0.6), color = "black") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  scale_x_discrete(limits = poolehoid_ci$erakond[1:9]) +
  labs(x = "Erakond",
       y = "Osakaal") +
  theme_light() 
```

---

### Paneme reitingud koos usalduspiiridega joonisele

```{r ref.label = "reitingud", fig.dim = c(7.5, 4.25), out.width = "100%", echo = FALSE, warning = FALSE, message = FALSE}
```

---

### Usaldusvahemike võrdlemine

- Usaldusvahemikud kattuvad omajagu

- Pelgalt usaldusevahemike kattumise vaatlemisel võiks öelda, et RE reiting võib tõepoolest olla tõusnud, aga võib ka olla, et valimite juhuslikkuse tõttu on reitingud olnud kahel kuul samad või üsnagi sarnased

- Sama saaks öelda ka KE kohta

- Siiski, sarnaselt keskmiste võrldemisega tuleks siingi võtta arvesse osakaalude erinevuse usaldusvahemikku (st RE reitingumuutuse usaldusvahemikku ja KE reitingumuutuse usaldusvahemikku)

- Kuidas osakaalude erinevuse usalduspiire arvutada?

---

### Osakaalude erinevuse usalduspiirid

- Kuidas osakaalude vahe usalduspiire arvutada?

- Erinev arvutusvalem sõltuvalt sellest, kas osakaalud on 

  - kahest erinevast jaotusest (kahest teineteisest sõltumatust kogumist) 
  
  - või samast jaotusest (osakaalud on osa ühest tervikust)

- Nt erakondade reitingute uurimise puhul: 

  - kas uurime erinevust ühe erakonna reitingutes kahel erineval ajahetkel 
  
  - või erakondade reitingute erinevusi samal ajahetkel

- Esimene juhtum: kahe osakaalu *z*-test (sõltumatute kogumite *z*-test)

---

### Kahe osakaalu *z*-test

$$Z = \frac{\hat{p}_1 - \hat{p}_2}{\sqrt{\hat{p}(1-\hat{p})(\frac{1}{n_1}+\frac{1}{n_2})}}$$

- $\hat{p}_1$ -- esimese grupi osakaal esimesest valimist $(n_1)$

- $\hat{p}_2$ -- teise grupi osakaal teisest valimist $(n_2)$

- $\hat{p}$ -- mõlema grupi osakaal mõlema valimi peale kokku: $\frac{\hat{p}_1 + \hat{p}_2}{n_1+n_2}$

- $n_1$ -- esimese valimi suurus

- $n_2$ -- teise valimi suurus

---

### Osakaalude erinevus kahe osakaalu *z*-testi põhjal

$$Z = \frac{\hat{p}_1 - \hat{p}_2}{\sqrt{\hat{p}(1-\hat{p})(\frac{1}{n_1}+\frac{1}{n_2})}}$$

- Kasutame funktsiooni `prop.test`, millele on vaja eraldi argumentidena ette anda vektor indiviidide arvudega kummaski grupis $c(\hat{p}_1 n_1, \hat{p}_2 n_2)$ ja valimimahtude vektor $c(n_1, n_2)$.

- Osakaalude vektor:

```{r}
ind_arv_gruppides <- reiting %>% 
  filter(erakond == "RE") %>% 
  pull(poolehoid_n)

ind_arv_gruppides
```

---

### Osakaalude erinevus kahe osakaalu *z*-testi põhjal

$$Z = \frac{\hat{p}_1 - \hat{p}_2}{\sqrt{\hat{p}(1-\hat{p})(\frac{1}{n_1}+\frac{1}{n_2})}}$$

Arvutame, kui palju vastajaid oli augustis ja septembris

```{r}
n1 <- reiting %>% 
  filter(kuu == "August") %>% 
  pull(poolehoid_n) %>% 
  sum()
n1

n2 <- reiting %>% 
  filter(kuu == "September") %>% 
  pull(poolehoid_n) %>% 
  sum()
n2
```

---

### Osakaalude erinevus kahe osakaalu *z*-testi põhjal

$$Z = \frac{\hat{p}_1 - \hat{p}_2}{\sqrt{\hat{p}(1-\hat{p})(\frac{1}{n_1}+\frac{1}{n_2})}}$$

```{r}
prop.test(ind_arv_gruppides, c(n1, n2), correct = FALSE)
```

---

### Osakaalude erinevus kahe osakaalu *z*-testi põhjal

- Tulemus näitab, et usaldusnivool 95% saab RE reitingumuutust väita küll 

  - usaldusvahemik ei sisalda nulli, kuigi, tõsi küll, ülemine ots ei ole nullist kuigi kaugel
  
  - sama näitab teststatistiku olulisuse tõenäosus, mis on väiksem 0,05-st (usaldusnivoole 95% vastavast olulisuse nivoost)

  - `prop.test` annab meile küll hii-ruut-statistiku, mitte *Z*, aga olulisuse tõenäosus on sama

---

### Harjutus 6

- Kas samal ajal kui RE reiting augusti ja septembri võrdluses tõusis, saame väita, et KE reiting langes?

---

### Sama jaotuse osakaalude erinevuse usalduspiirid

- Kuidas arvutada osakaalude erinevuse usalduspiire, kui osakaalud on pärit samast protsentjaotusest?

  - Nt reitingute erinevus samal ajahetkel

- Osakaalude erinevuse usalduspiiride valem (Scott ja Seber 1983):

$$p_1 - p_2 >= \hat{p}_1 - \hat{p}_2 - z_{1 - \frac{\alpha}{2}}\sqrt{\frac{\hat{p}_1+\hat{p}_2-(\hat{p}_1-\hat{p}_2)^2}{n}}$$

$$p_1 - p_2 <= \hat{p}_1 - \hat{p}_2 + z_{1 - \frac{\alpha}{2}}\sqrt{\frac{\hat{p}_1+\hat{p}_2-(\hat{p}_1-\hat{p}_2)^2}{n}}$$

- $p_1, p_2$ -- esimese ja teise grupi osakaal populatsioonis

- $\hat{p}_1, \hat{p}_2$ -- esimese ja teise grupi osakaal valimis

- $z_{1 - \frac{\alpha}{2}}$ -- standardiseeritud normaaljaotuse $1 - \frac{\alpha}{2}$-kvantiil

- $n$ -- valimi suurus

---

### Sama jaotuse osakaalude erinevuse usalduspiirid

- Uudise pealkiri oli, et RE tõusis septembris taas populaarseimaks parteiks

- Kas saame siiski uuringu andmetel öelda, et RE ja KE septembrireitingud erinevad ka populatsioonis (eeldades, et täisarvulised protsendid on täpsed ja et uuring põhineb lihtsal juhuvalimil)? 

  - Täpsemalt, kas usaldusnivool 95% on alust väita RE ja KE septembrireitingute erinevust? 

- Arvutame reitingute vahe usalduspiirid

- Selle jaoks on vaja RE ja KE septembrikuu reitinguid ja kõigi vastajate arvu septembris (viimane on eelnevalt arvutatud objektis `n2`).

---

### RE ja KE septembrikuu reitingud

- RE septembrikuu reiting

```{r}
p1 <- reiting %>% 
  filter(erakond == "RE" & kuu == "September") %>% 
  pull(poolehoid)
```

- KE septembrikuu reiting

```{r}
p2 <- reiting %>% 
  filter(erakond == "KE" & kuu == "September") %>% 
  pull(poolehoid)
```

---

### RE ja KE septembrireitingute erinevuse usalduspiirid

- Reitingute erinevus valimis

```{r}
p1 - p2
```


- Alumine usalduspiir: $p_1 - p_2 >= \hat{p}_1 - \hat{p}_2 - z_{1 - \frac{\alpha}{2}}\sqrt{\frac{\hat{p}_1+\hat{p}_2-(\hat{p}_1-\hat{p}_2)^2}{n}}$

```{r}
p1 - p2 - 1.96 * sqrt((p1 + p2 - (p1 - p2)^2) / n2) 
```

- Ülemine usalduspiir: $p_1 - p_2 <= \hat{p}_1 - \hat{p}_2 + z_{1 - \frac{\alpha}{2}}\sqrt{\frac{\hat{p}_1+\hat{p}_2-(\hat{p}_1-\hat{p}_2)^2}{n}}$

```{r}
p1 - p2 + 1.96 * sqrt((p1 + p2 - (p1 - p2)^2) / n2) 
```

- Mida nendest usalduspiiridest järeldada saame? (NB! Andmed on 2020. aasta septembri kohta)

---

### Harjutus 7

- KE ja RE reitingute erinevust 2020 septembris väita ei saanud. Kas 2020 augustis oli RE edumaa siiski statistilisest veast suurem, st sai väita RE kõrgemat reitingut KE-st?